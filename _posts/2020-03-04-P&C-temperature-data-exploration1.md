---
title: "[DACON] AI프렌즈 시즌1 온도 추정 경진대회 - 데이터 탐색_1"
excerpt: 온도 추정 경진대회의 데이터 탐색 내용입니다.
categories:
- P&C
toc : true
tags:
- 공모전
- 데이터탐색
- 기후
- 온도
- 센서
last_modified_at: 2020-03-04
---









# AI프렌즈 온도 추정 경진대회 데이터 탐색_1

[작업 파일](https://github.com/sirzzang/data_competition/blob/master/data_exploration_1_%EC%88%98%EC%A0%95.ipynb)

> 팀원들과 회의를 하기 전, 혼자 데이터를 살펴본 내용을 정리한다.





## *들어가기 전에*

데이터 설명 자료를 통해 column에 존재하는 것들에 대한 기본적인 정보를 파악할 필요가 있다고 생각했다.

* 현지 기압 : 어떠한 관측지점에서 관측된 기압.
* 해면기압 : 어떤 관측지점에서 관측된 현지기압을 그 지점에서 지구의 평균해면에서 관측된 값으로 환산하여 산출한 기압.

> 해면기압, 현지기압 굳이 두 개 사용해야 할까? 어차피 환산한 것인데? 해면기압만 사용해도 되지 않을까?

* 일사량 : 태양으로부터 오는 태양 복사 에너지(일사(日射))가 지표에 닿는 양. 태양광선에 직각으로 놓은 1제곱센티미터(㎠) 넓이에 1분 동안 복사되는 에너지의 양(輻射量)을 측정함으로써 알 수 있다.
  * 데이터에 있는 일사량은 일반적으로 검색할 때 나오는 일사량보다 크기가 작다. 다른 종류의 일사량인 것으로 보인다.(*산란일사량?*)
  * 일조량 : 일정한 물체나 땅의 겉면에 비치는 태양 광선의 양.







## 문제 정의



* 데이터 설명서를 보고 나서, 센서에서 측정한 온도 데이터(Y00~Y17)가 있고, 예측해야 할 타깃 속성은 Y18이라는 점에서 당황했다.
  * test data에는 Y00~Y17이 포함되어 있지 않다. 그렇다면 이 데이터는 왜 준 것인가?
  * 타깃속성 Y18을 예측하는 데 Y00~Y17이 어떻게 활용될 수 있을 것인가?
* (아직 팀원들과 논의를 거치지 않았지만) 일단 나는 다음과 같은 문제를 정의했다.
  * *"**기상정보 데이터(X00~X17)를 활용해, 타깃속성 Y18의 값을 예측한다.**"*
  * 문제 유형 : 지도학습, 회귀(값을 예측해야 하므로), 배치학습.





## 데이터 확인



### 데이터 정보 확인

`.info()` 메서드를 통해 각 속성의 타입, 결측치를 확인했다.

기본적으로 4752개의 데이터가 존재한다. 10분마다 측정된 데이터이므로, 1일은 144개의 행이라고 보면 된다.



**각 속성의 타입**

* id : 수치형이지만, 사실상 index의 역할을 한다.

* 나머지는 전부 수치형 데이터이다.

  * 풍향

    * 바람을 어떻게 수치형으로 표시하나 궁금해서 찾아봤다.

    > "바람이 불어 오는 방향을 말한다. 일반적으로 풍향은 16방위로 나타내는데, 북풍은 360°방향, 동풍은 90°, 남풍은 180°, 서풍은 270°방향으로 지리학상 진북을 기준으로 하여 시계방향으로 풍향을 나타낸다. 기준을 남북으로 하기 때문에 동북풍, 서남풍이라 하지 않고 북동풍, 남서풍이라 한다."
    >
    > *_대기환경용어사전([출처](http://www.kosae.or.kr/dictionary/new_sch.php?tent=D&code=al_seach&keyword=&sort=&page=75))*

    * 정의를 본 후, 풍향 변수를 방향에 따라 범주화하는 것은 어떨까 생각했다.

  * 누적강수량, 누적일사량 : 누적 형태로 표현된 변수이므로, 어느 순간 변화가 없을 것이라 보인다.



**각 속성별 결측치**

* Y00 ~ Y17까지의 열에 432개의 결측치가, Y18 열에 4320개의 결측치가 존재한다. 즉, 첫 30일 동안의 데이터에는 Y18 센서 측정 데이터가 존재하지 않는다.



#### 의문

* Y18이 타깃 속성인데, 훈련 데이터에 존재하지 않는다면, 30일 간의 데이터를 어떻게 훈련시켜야 할까?
* 다음과 같은 고민을 했다.
  * X00~X39 데이터를 이용해 Y00~Y17을 예측하고, Y00~Y17과 Y18의 관계를 알아낸다.
    * 모델이 복잡해진다. 게다가, 매개변수를 예측하고 그 예측한 변수로 또 타깃속성을 예측하는 것이 가능할까?
    * 타깃 속성은 Y18인데, Y00~Y17이 타깃 속성이 되어버릴 수도 있다.
  * Y00~Y18에 존재하는 결측치를 채운다.



### 데이터 요약 통계량 확인

`.describe()` 메서드 통해 [요약 통계량](https://github.com/sirzzang/data_competition/blob/master/competition/Dacon/AI%ED%94%84%EB%A0%8C%EC%A6%88%20%EC%8B%9C%EC%A6%8C1%20%EC%98%A8%EB%8F%84%20%EC%B6%94%EC%A0%95%20%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C/20200303/train_data_summary.csv)을 확인했다. 



1. 가장 먼저 파악할 수 있었던 것은 수치값의 스케일이 모두 다르다는 것이다. scaling이 필요할 것으로 보인다.

   * 특히 기압은 900, 1000 등 숫자가 크기 때문에 반드시 scaling해야 할 것으로 보인다.

     

2.  통계량 표를 통해 표준편차가 상대적으로 큰 것(값의 분포가 퍼져 있을 것이라 판단), 값의 분포가 갑자기 변화하는 것, 기타 값의 분포를 확인할 필요가 있는 것을 분류했다.

   * 표준편차가상대적으로 큰 특성 : X11, X12, X13, X15, X17, X20, X25, X30, X34, X35, X37
   * 값의 분포가 갑자기 변화하는 특성 : X02, X04, X10, X21, X25, X36
   * 값이 모두 0인 특성 : X14, X16, X19



3. 위에서 확인한 특성들을 각 속성별로 분류했다.

| 기온 | 현지기압 | 풍속 | 일일누적강수량 | 해면기압 | 누적일사량 | 습도 | 풍향 |
| :--: | :------: | :--: | :------------: | -------- | :--------: | :--: | :--: |
|      |          | X02  |      X04       |          |    X11     | X12  | X25  |
|      |          |      |      X10       |          |    X34     | X20  | X13  |
|      |          |      |      X21       |          |    X14     | X30  | X15  |
|      |          |      |      X36       |          |    X16     | X37  | X17  |
|      |          |      |      X39       |          |    X19     |      | X35  |

확실히 일일 누적강수량, 누적일사량에 특이한 속성이 많은 것으로 판단된다.



데이터의 측정 단위가 "누적"이기 때문에 다른 속성들과는 분포가 다른 것 같다.

* 일단, 누적 강수량과 일사량 모두 변화가 없는 시점이 존재할 것이다.
* 특히 강수량의 경우, 비가 오지 않은 날의 경우 0으로 측정될 것이다. 비가 온 날과 오지 않은 날을 구분하고, 비가 온 날의 누적일사량과 차이가 있는지 확인할 필요가 있다.
* 누적 일사량을 시간대별로 일사량을 계산해서 학습시키는 것은 어떨까? 어차피 그 시점에서의 온도를 측정하는 것이기 때문에, 누적 일사량은 의미가 없을 것이라 생각한다.
* 누적 강수량도 마찬가지로 시간대별 강수량을 계산해서 학습시키는 것은 어떨까? 또한, 비가 온 날과 오지 않은 날로 나누어, 누적 강수량을 원핫 벡터로 만들어 학습시키는 것은 어떨까?
* 누적 일사량의 경우, 모두 값이 0인 속성이 있다. 누적임에도 불구하고 0이라는 이야기는, 어쩌면 측정이 되지 않았다는 의미가 아닐까? 이 속성을 모두 배제하는 것이 어떨까?



위의 속성들을 히스토그램을 그려 자세히 살펴보기로 했다.



### 히스토그램을 통한 데이터 분포 확인

> 실제 작업을 진행할 때에는 크게 확인하기 위해 다음의 그림을 사용하지는 않았다.



![histogram]({{site.url}}/assets/images/dacon_temperature_attribute_histogram_plots.png)



* 일일 누적강수량
  * 누적 강수량임에도 불구하고 왼쪽이 두텁다는 것은, 비가 많이 오지 않는 계절임을 뜻하지 않을까?
  * 모든 센서들의 분포가 비슷하다. 특성을 조합할 수 있는지 생각해 보자.
* 누적일사량
  * 값이 0인 특성을 제외하면, 확실히 두 분포가 거의 비슷한 양상을 띤다. 
    * 강수량이 측정 위치에 따라서 조금씩 달라질 수 있는 반면, 일사량은 측정 위치에 따라 크게 영향을 받지 않는 것인가?
    * 혹은, 우연히 가깝게 있어서 비슷하게 측정되었나?
  * 두 센서의 특성을 조합할 수 있을까?
* 습도
  * 요약 통계량을 통해 볼 때 한 쪽으로 치우쳤을 것이라 생각했는데, 실제로 80 이상에 값이 많이 위치해 있었다.
  * 문득, 누적 강수량과 관련이 있을 수도 있다는 생각이 들었다.
* 풍향
  * 가장 분포가 다양했다. 
  * 문제가 온도 센서의 온도 예측값을 맞추는 것인데, 분포가 다양한 것이 도움이 될지, 노이즈로 작용할지 궁금하다.



이 외에, 다른 특성에 속하는 column들의 분포도 혹시 몰라 확인했다.

* 기온 : 분포가 가장 고르다. 특이한 점은 없어 보인다.
* 현지기압, 해면기압 : 역시 분포가 고르고, 특이한 점은 없어 보인다. 다만, 두 데이터가 모두 기압을 나타내고, 스케일의 차이도 크게 없기 때문에, 더 좋은 데이터를 선택하거나, 특성을 조합하는 방법을 생각해볼 필요가 있다.
* 풍속 : 왼쪽이 두꺼운 형태의 분포이다. 풍속이 4를 넘어 가면 빈도가 줄어든다. 바람이 세지 않은 계절임을 의미하는 것일까?



---

핸즈온 머신러닝 책에 따르면, 이 단계부터는 훈련 데이터를 훈련 세트와 테스트 세트로 분리하고 진행되어야 하는 탐색이다. 그러나 일단 다음과 같은 이유로 전체 훈련 데이터에 대해 탐색을 진행한다. 

* 책에서처럼 계층적 샘플링을 진행한다고 가정하자. 그러나 타깃 속성에 결측치가 많고, 어떤 것이 중요한 특성인지 결정하지 못했다.
* 또한 어떠한 방식으로 샘플링을 진행할 지, 어떻게 중요한 특성을 결정할지 등에 대해 팀원들과 논의가 이루어지지 않았다. 지금은 전적으로 회의 전 혼자 탐색하는 단계일 뿐이다.

따라서 팀원들과의 논의를 진행한 후, 테스트 세트를 떼어 놓고 어떻게 탐색할 지 고민하기로 한다.





## 시각화



일단 지금 단계에서 구상한 시각화 계획은 두 가지이다.

* 누적 일사량, 누적 강수량을 일별로 나누어 시각화.
* 풍향, 풍속 시각화.



아직 데이터 탐색이 부족해 어떤 방식으로 시각화해야 할지 떠오르지 않는다. 이 역시 팀원들과의 논의를 거친 후, 보충할 예정이다.



### 누적 일사량, 강수량 시각화

* 각 데이터를 일별로 나눈다.

* 일별로 나누었을 때 누적 일사량, 누적 강수량에서 중요한 것은 최댓값이라고 생각했다. 아직 feature engineering을 진행하지 않았기 때문에, 누적 합을 시간별로 쪼개는 작업을 진행하지 않았다. 따라서 누적되는 데이터의 특성상, 누적되기 때문에 가장 마지막에 측정한 값이 그 자체로는 가장 의미있어 보인다.

* 시각화를 진행한 결과는 다음과 같다.

  *참고) 누적 일사량에서 0인 센서 제외*

| 누적 강수량 최댓값                                           | 누적 일사량 최댓값                                           |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![precipitation]({{site.url/assets/images/max_precipitation.png}}) | ![solar]({{site.url}}/assets/images/max_solar_radiation.png) |

	1. 누적 일사량의 두 분포는 거의 비슷하다.
 	2. 비가 온 날에는, 최대 일사량이 다른 날에 비해 눈에 띄게 작아진다.



### 풍향, 풍속 시각화

windrose 패키지 연구 중.





## 상관관계 분석

 

이 단계에서 주로 살펴볼 것은 다음과 같다.

1. X00~X39 속성 간 상관관계

   * 앞 단계들을 진행하면서, 센서가 측정하는 온도에 영향을 미치는 것들로,

     * 가장 중요한 것은 기온이라고 추측했고,
     * 기온과 일사량이 상관관계가 있을 것이라 추측했고,
     * 기온 및 일사량과 강수량은 음의 상관관계가 있을 것이라 추측했다.

     특히, 이 외에도

     * 기압, 풍속 등은 온도와 직접적인 관계가 있지 않더라도 온도와 매개 관계에 있을 수 있는 계절, 강수 여부 등 다른 정보를 알려줄 수 있을 것이라 추측했고,
     * 풍향이 노이즈가 될지, 긍정적으로 작용할지 궁금했다.

     이러한 것들을 확인하고 싶다.

   * 한편, 특성이 나타내는 정보에 집중하다 보니, 나의 편향된 시선이 아니라, 각 column 간 명확하게 숫자로만 이야기할 수 있는 상관관계를 확인하고 싶다.

   * 이렇게 확인한 상관관계는 나중에 변수를 engineering하는 데 있어서 도움이 될 것이다.

2. X00~X39 속성과 Y00~Y18 간 상관관계

   * 센서의 온도 데이터를 예측하는 데 있어 영향력이 강한 변수가 무엇일까?
   * Y00~Y17과 연관성이 높은 변수가, Y18과도 연관성이 높을까?



그러나 결측치가 있었기 때문에, 상관관계 행렬을 다음과 같이 경우를 나누어 구했다. 모든 값이 0인 경우, 상관관계 행렬에서 0이 나올 수 있다.

* Y00~Y17까지의 데이터와 X00~X39 데이터 : 4320행까지만 사용.
* Y18과 X00~X39 데이터 : 4321행부터 사용.
* Y00~Y18까지의 데이터에서 결측치를 중간값으로 채운 뒤 전체 데이터.
  * X00~X39 전체 데이터를 사용하므로, 여기서 위의 1.을 확인한다.



각 경우에 대해 각 column과 상관관계가 높은 순으로 정렬한 결과는 다음과 같다.



### Y00~Y17까지의 데이터와 X00~X39 데이터



**양의 상관관계 : 0.7 이상**

|          Y00          | Y01  | Y02  | Y03  | Y04  | Y05  | Y06  | Y07  | Y08  |
| :-------------------: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
|          X07          | X07  | X07  | X28  | X28  | X00  | X32  | X32  | X00  |
|          X28          | X32  | X32  | X07  | X07  | X32  | X00  | X00  | X07  |
|          X32          | X31  | X28  | X34  | X34  | X31  | X31  | X31  | X31  |
|          X31          | X28  | X31  | X11  | X11  | X07  | X07  |      | X32  |
|          X00          | X00  | X00  | X31  | X31  | X28  | X28  |      | X28  |
|          X34          |      |      | X32  | X32  |      |      |      |      |
| X11<sup>(0.699)</sup> |      |      | X00  | X00  |      |      |      |      |

| Y09  | Y10  | Y11  | Y12  | Y13  | Y14  | Y15  | Y16  | Y17  |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| X32  | X32  | X32  | X32  | X07  | X07  | X32  | X00  | X32  |
| X00  | X31  | X00  | X00  | X00  | X28  | X00  | X32  | X00  |
| X31  | X00  | X31  | X31  | X32  | X31  | X31  | X31  | X31  |
| X07  | X28  | X07  | X07  | X31  | X00  | X07  | X07  | X07  |
| X28  |      | X28  | X28  | X28  | X32  | X28  | X28  | X28  |
|      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |

* 주로 등장하는 열을 통해, 기온이 센서 측정 온도와 매우 높은 양의 상관관계에 있음을 알 수 있다.
  * X00, X31, X32 : 기온
  * X07, X28 : 기온
* 그 외에, 누적 일사량에 속하는 X11, X34도 있었다.
  * 누적 일사량이 많으면 기온이 높기 때문은 아닐까?



**음의 상관관계 : -0.7 이하**

| Y00  | Y01  | Y02  | Y03  | Y04  | Y05  | Y06  |          Y07          | Y08  |
| :--: | :--: | :--: | :--: | :--: | ---- | :--: | :-------------------: | :--: |
| X12  | X12  | X12  |      |      | X12  | X12  |          X30          | X12  |
| X20  | X20  | X20  |      |      | X20  | X30  |          X12          | X20  |
| X30  | X30  | X30  |      |      | X30  | X20  | X20<sup>(-0.69)</sup> | X30  |
| X37  | X37  | X37  |      |      | X37  |      |                       | X37  |
|      | X38  | X38  |      |      |      |      |                       |      |

>  Y03, Y04는 -0.7이하인 열은 없었으나, 낮은 순서는 앞의 세 column과 일치한다.

| Y09  | Y10  | Y11  | Y12  | Y13  | Y14  | Y15  | Y16  | Y17  |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| X12  | X12  | X12  | X12  | X12  | X12  | X12  | X12  | X12  |
| X20  | X20  | X20  | X30  | X20  | X20  | X20  | X20  | X20  |
| X30  | X30  | X30  | X20  | X30  | X30  | X30  | X30  | X30  |
| X37  | X37  | X37  |      | X37  | X37  | X37  | X37  | X37  |

* 주로 등장하는 열을 통해, 습도가 센서 측정 온도와 매우 높은 음의 상관관계에 있음을 알 수 있다. 특히 음의 상관관계 순서까지 대부분 일치한다.
  * X12, X20, X30 : 습도
  * X37, X38 : 습도
* 습도와 강수량이 밀접한 관련이 있을 것이라 생각했는데, 누적 강수량은 상관관계가 명확하게 나타나지 않는다. 이후 강수량을 시간 단위로 쪼개고 다시 확인해 볼 필요가 있다.





### Y18과 X00~X39 데이터



Y18은 타깃속성이기 때문에, 샘플이 적지만 구간을 나눠서 살펴보기로 한다.



**양의 상관관계**

| 0.7 이상 | 0.4 이상<br />0.7 미만 |
| :------: | :--------------------: |
|   X31    | X24<sup>(0.697)</sup>  |
|   X32    |          X25           |
|   X00    |          X26           |
|   X07    |                        |
|   X28    |                        |
|   X18    |                        |

* 강한 양의 상관관계 : 위와 마찬가지로 기온이며, 풍속이 추가된다.
  * X00, X07, X28, X31, X32 :기온
  * X18 : 풍속
* 중간 수준의 양의 상관관계
  * X24, X26 : 풍속
  * X25 : 풍향
* 위에서의 분석 결과에 더해 바람과 연관된 풍속, 풍향도 어느 정도 양의 상관관계에 있음을 알 수 있다.



**음의 상관관계**

| -0.7 이하 | -0.7 초과<br />-0.4 이하 |
| :-------: | :----------------------: |
|    X12    |           X08            |
|    X30    |           X09            |
|    X37    |           X23            |
|    X20    |           X06            |
|    X38    |           X05            |
|           |           X29            |
|           |           X01            |
|           |           X33            |
|           |           X22            |
|           |           X27            |

* 강한 음의 상관관계 : 위에서와 마찬가지로 모두 습도이다.
* 중간 수준의 음의 상관관계를 통해, 위에서는 파악하지 않았지만, 기압 카테고리도 어느 정도 음의 상관관계를 띠고 있음을 알 수 있다.
  * X08, X09, X23 : 해면기압, X06 : 현지기압
  * X05, X33 :해면기압, X29, X01, X22, X27 :현지기압





### 중간값으로 결측치를 채운 데이터



#### X00~X39 간 상관관계

**양의 상관관계**

| X00  | X01  | X02  | X03  | X04  | X05  | X06  | X07  | X08  | X09  |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | ---- |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |

| X10  | X11  | X12  | X13  | X14  | X15  | X16  | X17  | X18  | X19  |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | ---- |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |
|      |      |      |      |      |      |      |      |      |      |



#### Y18과 X00~X39 간 상관관계



**양의 상관관계**

| 0.7 이상 | 0.4 이상<br />0.7 미만 |
| :------: | :--------------------: |
|   X31    | X24<sup>(0.697)</sup>  |
|   X32    |          X25           |
|   X00    |          X26           |
|   X07    |                        |
|   X28    |                        |
|   X18    |                        |

* 중간값으로 결측치를 채웠을 때, 크게 달라지지는 않는다.



**음의 상관관계**

| -0.7 이하 | -0.7 초과<br />-0.4 이하 |
| :-------: | :----------------------: |
|    X12    |           X08            |
|    X30    |           X09            |
|    X37    |           X23            |
|    X20    |           X06            |
|    X38    |           X05            |
|           |           X29            |
|           |           X01            |
|           |           X33            |
|           |           X22            |
|           |           X27            |

* 마찬가지로, 크게 달라지지 않는다.











상관관계를 보니 양의 상관관계, 음의 상관관계에 있는 특성들이 명확해 보인다.

* 선형 모델 적용하는 것은 어떨까?
* 특히, 내가 추측한 것도 그렇고, 상관관계로 인해 나타나는 바도 그렇고, 분명 변수들 사이에 내재된 관계가 존재하는 것 같다. 지난 공모전 때는 주성분분석을 제대로 알지 못했지만, 공부해서 적용해보는 것은 어떨까? 반드시 차원축소를 진행해야 할 것 같다.



중간값으로 채워도 크게 상관관계가 달라지지 않는 것을 보니, 중간값으로 채워서 학습을 진행해도 될까?







# 논의하고 싶은 내용







